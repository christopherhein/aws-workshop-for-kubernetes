= Environment
:toc: macro
:icons:
:linkattrs:

= Setup Development Environment

toc::[]

This section walks you through the creating a Kubernetes development 
environment using https://aws.amazon.com/cloud9/[AWS Cloud9].  This will
provide you with a cloud-based integrated development environment (IDE) 
that will let you write, run, and debug containerized workloads using just a
web browser.

== Create AWS Cloud9 Environment

We can create the Cloud9 development environment via CloudFormation.
This CloudFormation template will spin up the Cloud9 IDE, as well as configure
the IDE environment for the rest of the workshop.

The CloudFormation template can create a new VPC, or you can choose an existing
VPC if needed.
If you are unsure, we recommend the *Launch template with an existing VPC* 
option.

Click on the *Deploy to AWS* button and follow the CloudFormation prompts to 
begin.

[NOTE]
AWS Cloud9 is currently available in 5 regions.
Please choose the region closest to you.

|===

| *Region* | *Launch template with a new VPC* | *Launch template with an existing VPC*
| *N. Virginia* (us-east-1)
a| image::environment/deploy-to-aws.png[link=https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=k8s-workshop&templateURL=https://s3.amazonaws.com/aws-kubernetes-artifacts/lab-ide-vpc.template, window="_blank"]
a| image::environment/deploy-to-aws.png[link=https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/new?stackName=k8s-workshop&templateURL=https://s3.amazonaws.com/aws-kubernetes-artifacts/lab-ide-novpc.template, window="_blank"]

| *Ohio* (us-east-2)
a| image::environment/deploy-to-aws.png[link=https://console.aws.amazon.com/cloudformation/home?region=us-east-2#/stacks/new?stackName=k8s-workshop&templateURL=https://s3.amazonaws.com/aws-kubernetes-artifacts/lab-ide-vpc.template, window="_blank"]
a| image::environment/deploy-to-aws.png[link=https://console.aws.amazon.com/cloudformation/home?region=us-east-2#/stacks/new?stackName=k8s-workshop&templateURL=https://s3.amazonaws.com/aws-kubernetes-artifacts/lab-ide-novpc.template, window="_blank"]

| *Oregon* (us-west-2)
a| image::environment/deploy-to-aws.png[link=https://console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks/new?stackName=k8s-workshop&templateURL=https://s3.amazonaws.com/aws-kubernetes-artifacts/lab-ide-vpc.template, window="_blank"]
a| image::environment/deploy-to-aws.png[link=https://console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks/new?stackName=k8s-workshop&templateURL=https://s3.amazonaws.com/aws-kubernetes-artifacts/lab-ide-novpc.template, window="_blank"]

| *Ireland* (eu-west-1)
a| image::environment/deploy-to-aws.png[link=https://console.aws.amazon.com/cloudformation/home?region=eu-west-1#/stacks/new?stackName=k8s-workshop&templateURL=https://s3.amazonaws.com/aws-kubernetes-artifacts/lab-ide-vpc.template, window="_blank"]
a| image::environment/deploy-to-aws.png[link=https://console.aws.amazon.com/cloudformation/home?region=eu-west-1#/stacks/new?stackName=k8s-workshop&templateURL=https://s3.amazonaws.com/aws-kubernetes-artifacts/lab-ide-novpc.template, window="_blank"]

| *Singapore* (ap-southeast-1)
a| image::environment/deploy-to-aws.png[link=https://console.aws.amazon.com/cloudformation/home?region=ap-southeast-1#/stacks/new?stackName=k8s-workshop&templateURL=https://s3.amazonaws.com/aws-kubernetes-artifacts/lab-ide-vpc.template, window="_blank"]
a| image::environment/deploy-to-aws.png[link=https://console.aws.amazon.com/cloudformation/home?region=ap-southeast-1#/stacks/new?stackName=k8s-workshop&templateURL=https://s3.amazonaws.com/aws-kubernetes-artifacts/lab-ide-novpc.template, window="_blank"]

|===

To open the Cloud9 IDE environment, click on the *Outputs* tab in
CloudFormation Console and click on the *Cloud9IDE* URL.

image:environment/cloudformation-output-tab.png[CloudFormation Output Tab]

You should see an environment similar to this:

image:environment/cloud9-development-environment-welcome.png[]

=== Build Script

Once your Cloud9 environment is ready, download the build script and install in
your IDE. This will prepare your IDE for running tutorials in this workshop.
The build script installs the following:

- `jq`
- `kubectl` _(the Kubernetes CLI, which we'll cover in great detail later in 
  the workshop)_
- `kops` _(Kubernetes Operations, which we'll also cover in detail later)_
- configures the AWS CLI and stores necessary environment variables in 
  bash_profile
- creates an SSH key
- clone the workshop repository into Cloud9

To install the script, run this command in the "bash" terminal tab of the 
Cloud9 IDE:

[source,shell]
----
aws s3 cp s3://aws-kubernetes-artifacts/lab-ide-build.sh . && \
chmod +x lab-ide-build.sh && \
. ./lab-ide-build.sh
----

image:environment/cloud9-run-script.png[Running the script in Cloud9 Terminal]

At this point you can restart the Cloud9 IDE terminal session to ensure that
the kubectl completion is enabled. Once a new terminal window is opened, type
`kubectl get nodes`. You do not have to run the command. _It is normal for this
command to fail with an error message if you run it. You have not yet created
the Kubernetes cluster._ We are merely testing to make sure the `kubectl` tool
is installed on the command line correctly and can autocomplete.

One last step is required so that the Cloud9 IDE uses the assigned IAM Instance 
profile. Open the *AWS Cloud9* menu, go to *Preferences*, go to *AWS Settings*, 
and disable *AWS managed temporary credentials* as depicted in the diagram 
here:

image:environment/cloud9-disable-temp-credentials.png[]
